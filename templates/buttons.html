<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bier Broker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container card shadow p-4 mx-auto my-5">
        <h1 class="mb-3 text-center">Bier Broker</h1>
        <div id="buttons" class="mb-3">
            <div class="row">
                
                <div class="col">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Bier 0,3l</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="bier03_anzahl" min="0" value="0" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="bier03_price">1.50</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>

                <div class="col col-lg-*">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Bier 0,5l</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="bier05_anzahl" min="0" value="0" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="bier05_price">2.00</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Mische</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="mische_anzahl" min="0" value="0" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="mische_price">3.00</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>

                <div class="col col-lg-*">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Shot</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="shot_anzahl" min="0" value="0" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="shot_price">1.00</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Cider</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="cider_anzahl" min="0" value="0" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="cider_preis">2.00</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>

                <div class="col col-lg-*">
                    <div class="row alert alert-dark mx-auto">
                        <div class="col-4">
                            <h3 class="label label-primary">Bachwasser</h3>
                        </div>
                        <div class="col-6">
                            <input type="number" id="bachwasser_anzahl" min="0" value="0" oninput="calculateTotalPrice()" oninput="calculateTotalPrice()">
                        </div>
                        <div class="col">
                            <span id="bachwasser_preis">2.00</span>
                            <span>€</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-3 text-center ">
            <div class="row alert alert-dark mx-auto w-75">
                <div class="col">
                    <label class="h4">Gesamt Preis</label>
                </div>
                <div class="col-6">
                    <label id="price_total" class="h4"></label>
                    <span class="h4">€</span>
                </div>
                <div class="col">
                    <button onclick="invest()" class="btn btn-primary">Investieren</button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        ////////////
        // Config //
        ////////////
        const config = {{ config|tojson|safe }}
        const refreshTimer_s = config.intervall_s;

        ///////////
        // Timer //
        ///////////
        let seconds = refreshTimer_s;

        // timer = setInterval(function() {
        //     seconds--;
        //     let minutes = Math.floor(seconds / 60);  // Minuten berechnen
        //     let displaySeconds = seconds % 60;  // Sekunden berechnen

        //     // Timer im Format MM:SS anzeigen
        //     document.getElementById('timerDisplay').textContent =
        //         `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
        // }, 1000);


        //////////////////
        // Auto Refresh //
        //////////////////
        setInterval(function() {
            location.reload();
        }, refreshTimer_s * 1000);

        ////////////////
        // Preisliste //
        ////////////////
        const prices = {{ prices|tojson|safe }}; 

        const bier03_price = prices[0].price;
        const bier05_price = prices[1].price;
        const mische_price = prices[2].price;
        const shot_price = prices[3].price;
        const cider_price = prices[4].price;
        const bachwasser_price = prices[5].price;

        document.getElementById('bier03_price').innerText = bier03_price;
        document.getElementById('bier05_price').innerText = bier05_price;
        document.getElementById('mische_price').innerText = mische_price;
        document.getElementById('shot_price').innerText = shot_price;
        document.getElementById('cider_preis').innerText = cider_price;
        document.getElementById('bachwasser_preis').innerText = bachwasser_price;
    
        function calculateTotalPrice() {
            const bier03Count = parseInt(document.getElementById('bier03_anzahl').value)         || 0;
            const bier05Count = parseInt(document.getElementById('bier05_anzahl').value)         || 0;
            const mischeCount = parseInt(document.getElementById('mische_anzahl').value)         || 0;
            const shotCount = parseInt(document.getElementById('shot_anzahl').value)             || 0;
            const ciderCount = parseInt(document.getElementById('cider_anzahl').value)           || 0;
            const bachwasserCount = parseInt(document.getElementById('bachwasser_anzahl').value) || 0;

            const totalPrice = 
                (bier03_price * bier03Count) +
                (bier05_price * bier05Count) +
                (mische_price * mischeCount) +
                (shot_price * shotCount) +
                (cider_price * ciderCount) +
                (bachwasser_price * bachwasserCount);

            document.getElementById('price_total').innerText = totalPrice.toFixed(2);
        }

        function invest() {
            // Collect input values
            const investmentData = {
                "bier03": parseInt(document.getElementById('bier03_anzahl').value) || 0,
                "bier05": parseInt(document.getElementById('bier05_anzahl').value) || 0,
                "mische": parseInt(document.getElementById('mische_anzahl').value) || 0,
                "shot": parseInt(document.getElementById('shot_anzahl').value) || 0,
                "cider": parseInt(document.getElementById('cider_anzahl').value) || 0,
                "bachwasser": parseInt(document.getElementById('bachwasser_anzahl').value) || 0
            };

            console.log(investmentData);

            // Send investment data to the server (assuming there's an endpoint to handle it)
            fetch('/process_input', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(investmentData)
            })
            .then(data => {
                console.log('Investment processed:', data);
            })
            .catch(error => console.error('Error processing investment:', error));

            // Reset input fields and total price
            document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
            document.getElementById('price_total').innerText = '0';
        }
    </script>
</body>
</html>
