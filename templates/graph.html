<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bierkurs</title>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container card shadow p-4 mx-auto my-5">
        <div id="header" class="container">
            <h1>Bierbörse Stelli 2024</h1>
        </div>
        <div class="row alert alert-dark">
            <div class="col-10">
                <div id="graph"></div>
        
                <script>
                    // Initial rendering of the graph with data passed from Flask
                    const initialGraphData = {{ graph_json | safe }};
                    Plotly.newPlot('graph', initialGraphData);
        
                    // Function to fetch new data and update the graph
                    function updateGraph() {
                        fetch('/update_graph')
                            .then(response => response.json())
                            .then(data => {
                                const graphData = JSON.parse(data.graph_json);
                                Plotly.react('graph', graphData);
                            })
                            .catch(error => console.error('Error fetching graph data:', error));
                    }
        
                    // Refresh the graph every 30 seconds without reloading the page
                    setInterval(updateGraph, 1000); // 30 seconds
                </script>
            </div>
            <div class="col-6">
                <h1>Preisliste</h1>

                <div class="col-6">
                    <ul id="name-list"></ul>  <!-- Die Liste wird hier befüllt -->
                </div>

                <div class="col-6">
                    <ul id="price-list"></ul>  <!-- Die Liste wird hier befüllt -->
                </div>

                <script>
                    const prices = {{ prices|tojson|safe }};  // Angenommene Übergabe der JSON-Daten aus dem Backend

                    const nameList = document.getElementById("name-list");
                    const priceList = document.getElementById("price-list");

                    // Schleife durch die Getränke und Erstellen der Listeneinträge
                    prices.forEach(beverage => {

                        // Erstellen eines neuen Listenelements
                        const nameli = document.createElement("li");
                        const priceli = document.createElement("li");
                        nameli.classList.add("name-item");
                        priceli.classList.add("price-item");

                        // Erstellen des Namens-Spans
                        const nameSpan = document.createElement("span");
                        nameSpan.classList.add("name");
                        nameSpan.textContent = beverage.name;

                        // Erstellen des Preis-Spans
                        const priceSpan = document.createElement("span");
                        priceSpan.classList.add("price");
                        priceSpan.textContent = beverage.price + "€";

                        // Append Name und Preis-Container zum Listenelement
                        nameli.appendChild(nameSpan);
                        priceli.appendChild(priceSpan);

                        // Füge das Listenelement zur Liste hinzu
                        nameList.appendChild(nameli);
                        priceList.appendChild(priceli);
                    });
                </script>
            </div>

        </div>
    </div>
    <div id="content" class="container">
    </div>
</body>
</html>
